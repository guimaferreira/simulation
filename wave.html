<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Interactive Wave Function Simulation</title>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
        overflow: hidden;
      }
      canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      #controls {
        position: fixed;
        top: 40px;
        left: 10px;
        background: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 8px;
        z-index: 10;
      }
      label {
        display: block;
        margin: 5px 0;
      }
      #toggle-controls {
        position: fixed;
        top: 10px;
        left: 10px;
        cursor: pointer;
        padding: 5px 10px;
        background: #ddd;
        border: none;
        border-radius: 5px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <button id="toggle-controls">â˜° Controls</button>
    <div id="controls"></div>
    <canvas id="waveCanvas"></canvas>
    <script>
      function simulateWaveFunction(
        amplitude,
        frequency,
        phase,
        points,
        red,
        green,
        blue,
        opacity
      ) {
        const wavePoints = [];
        const step = (2 * Math.PI) / points;
        for (let i = 0; i < points; i++) {
          const x = i * step;
          const y = amplitude * Math.sin(frequency * x + phase);
          const z = 0; // Assuming a 2D wave, z will be constant
          const rgba = {
            r: red,
            g: green,
            b: blue,
            a: opacity / 100,
          };
          wavePoints.push({ x, y, z, rgba });
        }
        return wavePoints;
      }

      function draw(options) {
        const {
          amplitude,
          frequency,
          phase,
          points,
          size,
          opacity,
          red,
          green,
          blue,
        } = options;

        const canvas = document.getElementById("waveCanvas");
        const ctx = canvas.getContext("2d");
        const waveData = simulateWaveFunction(
          amplitude,
          frequency,
          phase,
          points,
          red,
          green,
          blue,
          opacity
        );
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const scaleFactor = canvas.width / (2 * Math.PI); // Scale factor based on canvas width

        waveData.forEach(({ x, y, z, rgba }) => {
          ctx.fillStyle = `rgba(${rgba.r}, ${rgba.g}, ${rgba.b}, ${rgba.a})`;
          const canvasX = x * scaleFactor;
          const canvasY = y + canvas.height / 2; // Center the wave vertically
          ctx.fillRect(canvasX, canvasY, size, size);
        });
      }

      // Update all values from the sliders

      const controlsConfig = [
        { id: "amplitude", min: 0, max: 10000, step: 100, value: 470 },
        { id: "frequency", min: 0, max: 9770, step: 50, value: 2 },
        { id: "phase", min: 0, max: 6.283, step: 0.1, value: 0, unit: " rad" },
        { id: "points", min: 100, max: 10000, step: 100, value: 2000 },
        { id: "size", min: 1, max: 100, step: 1, value: 10, unit: " px" },
        { id: "opacity", min: 1, max: 100, step: 1, value: 33, unit: "%" },
        { id: "red", min: 0, max: 100, step: 1, value: 100, unit: "%" },
        { id: "green", min: 0, max: 100, step: 1, value: 100, unit: "%" },
        { id: "blue", min: 0, max: 100, step: 1, value: 100, unit: "%" },
        { id: "entropy", min: 0, max: 10, step: 0.1, value: 0.5, unit: "" },
      ];

      window.onload = function () {
        const controlsContainer = document.getElementById("controls");
        controlsConfig.forEach((config) => {
          const control = new Control(config);
          control.init(controlsContainer);
        });
        updateWave(); // Draw initial wave
      };

      function updateWave() {
        draw({
          amplitude: +sessionStorage.getItem("amplitude"),
          frequency: +sessionStorage.getItem("frequency"),
          phase: +sessionStorage.getItem("phase"),
          points: +sessionStorage.getItem("points"),
          size: +sessionStorage.getItem("size"),
          opacity: +sessionStorage.getItem("opacity"),
          red: Math.round(sessionStorage.getItem("red") * 2.55),
          green: Math.round(sessionStorage.getItem("green") * 2.55),
          blue: Math.round(sessionStorage.getItem("blue") * 2.55),
          entropy: +sessionStorage.getItem("entropy"),
        });
      }

      class Control {
        constructor({ id, min, max, step, value, unit = "", type = "range" }) {
          this.id = id;
          this.min = min;
          this.max = max;
          this.step = step;
          this.value = value;
          this.unit = unit;
          this.type = type;
          this.slider = null;
          this.valueDisplay = null;
        }

        init(container) {
          const wrapper = document.createElement("div");
          const label = document.createElement("label");
          label.htmlFor = this.id;
          label.textContent = `${
            this.id.charAt(0).toUpperCase() + this.id.slice(1)
          }: `;

          this.valueDisplay = document.createElement("span");
          this.valueDisplay.id = `${this.id}-value`;
          this.valueDisplay.textContent = this.value + this.unit;

          this.slider = document.createElement("input");
          this.slider.type = this.type;
          this.slider.id = this.id;
          this.slider.min = this.min;
          this.slider.max = this.max;
          this.slider.step = this.step;
          this.slider.value = this.value;

          wrapper.appendChild(label);
          label.appendChild(this.valueDisplay);
          wrapper.appendChild(this.slider);
          container.appendChild(wrapper);

          this.slider.addEventListener("input", () => {
            this.updateValue();
          });
        }

        updateValue() {
          const value = this.slider.value;
          this.valueDisplay.textContent = value + this.unit;
          sessionStorage.setItem(this.id, value);
          updateWave(); // Assuming a global function to update the canvas
        }
      }
    </script>
  </body>
</html>
