<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Interactive Wave Function Simulation</title>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
        overflow: hidden;
      }
      canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      #controls {
        position: fixed;
        top: 40px;
        left: 10px;
        background: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 8px;
        z-index: 10;
      }
      label {
        display: block;
        margin: 5px 0;
      }
      #toggle-controls {
        position: fixed;
        top: 10px;
        left: 10px;
        cursor: pointer;
        padding: 5px 10px;
        background: #ddd;
        border: none;
        border-radius: 5px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <button id="toggle-controls">â˜° Controls</button>
    <div id="controls">
      <label for="amplitude"
        >Amplitude: <span id="amplitude-value">470</span></label
      >
      <input
        type="range"
        id="amplitude"
        min="0"
        max="10000"
        value="470"
        step="100"
      />

      <label for="frequency"
        >Frequency: <span id="frequency-value">2</span></label
      >
      <input
        type="range"
        id="frequency"
        min="0"
        max="9770"
        value="2"
        step="50"
      />

      <label for="phase">Phase: <span id="phase-value">0</span></label>
      <input
        type="range"
        id="phase"
        min="0"
        max="2 * Math.PI"
        value="0"
        step="0.1"
      />
      2000
      <label for="points">Points: <span id="points-value">1000</span></label>
      <input
        type="range"
        id="points"
        min="100"
        max="10000"
        value="2000"
        step="100"
      />

      <label for="size">Size: <span id="size-value">2</span> px</label>
      <input type="range" id="size" min="1" max="100" value="10" step="1" />

      <label for="opacity">Opacity: <span id="opacity-value">33</span>%</label>
      <input type="range" id="opacity" min="1" max="100" value="33" step="1" />
    </div>
    <canvas id="waveCanvas"></canvas>
    <script>
      function simulateWaveFunction(amplitude, frequency, phase, points) {
        const wavePoints = [];
        const step = (2 * Math.PI) / points;
        for (let i = 0; i < points; i++) {
          const x = i * step;
          const y = amplitude * Math.sin(frequency * x + phase);
          wavePoints.push({ x: x, y: y });
        }
        return wavePoints;
      }

      function draw(amplitude, frequency, phase, points, size, opacity) {
        const canvas = document.getElementById("waveCanvas");
        const ctx = canvas.getContext("2d");
        const waveData = simulateWaveFunction(
          amplitude,
          frequency,
          phase,
          points
        );
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = `rgba(0, 0, 0, ${opacity / 100})`;

        const scaleFactor = canvas.width / (2 * Math.PI); // Scale factor based on canvas width

        waveData.forEach((point) => {
          const x = point.x * scaleFactor;
          const y = point.y + amplitude; //* (canvas.height / (2 * amplitude)); // Center and scale the wave
          ctx.fillRect(x, y, size, size);
        });
      }

      const amplitudeSlider = document.getElementById("amplitude");
      const frequencySlider = document.getElementById("frequency");
      const phaseSlider = document.getElementById("phase");
      const pointsSlider = document.getElementById("points");
      const sizeSlider = document.getElementById("size");
      const opacitySlider = document.getElementById("opacity");

      const sliders = [
        amplitudeSlider,
        frequencySlider,
        phaseSlider,
        pointsSlider,
        sizeSlider,
        opacitySlider,
      ];

      function updateValues() {
        // Get slider elements
        let amplitudeSlider = document.getElementById("amplitude");
        let frequencySlider = document.getElementById("frequency");
        let phaseSlider = document.getElementById("phase");
        let pointsSlider = document.getElementById("points");
        let sizeSlider = document.getElementById("size");
        let opacitySlider = document.getElementById("opacity");

        // Update placeholders
        document.getElementById("amplitude-value").textContent =
          amplitudeSlider.value;
        document.getElementById("frequency-value").textContent =
          frequencySlider.value;
        document.getElementById("phase-value").textContent = phaseSlider.value;
        document.getElementById("points-value").textContent =
          pointsSlider.value;
        document.getElementById("size-value").textContent = sizeSlider.value;
        document.getElementById("opacity-value").textContent =
          opacitySlider.value;

        // Store values in session storage
        sessionStorage.setItem("amplitude", amplitudeSlider.value);
        sessionStorage.setItem("frequency", frequencySlider.value);
        sessionStorage.setItem("phase", phaseSlider.value);
        sessionStorage.setItem("points", pointsSlider.value);
        sessionStorage.setItem("size", sizeSlider.value);
        sessionStorage.setItem("opacity", opacitySlider.value);

        // Call a function to redraw the graph
        draw(
          +amplitudeSlider.value,
          +frequencySlider.value,
          +phaseSlider.value,
          +pointsSlider.value,
          +sizeSlider.value,
          +opacitySlider.value
        );
      }

      function setSliderValues() {
        console.log("Setting slider values");
        // Read values from session storage
        let amplitude = sessionStorage.getItem("amplitude");
        let frequency = sessionStorage.getItem("frequency");
        let phase = sessionStorage.getItem("phase");
        let points = sessionStorage.getItem("points");
        let size = sessionStorage.getItem("size");
        let opacity = sessionStorage.getItem("opacity");

        // Set slider and placeholder values if they are stored
        if (amplitude !== null) {
          document.getElementById("amplitude").value = amplitude;
          document.getElementById("amplitude-value").textContent = amplitude;
        }
        if (frequency !== null) {
          document.getElementById("frequency").value = frequency;
          document.getElementById("frequency-value").textContent = frequency;
        }
        if (phase !== null) {
          document.getElementById("phase").value = phase;
          document.getElementById("phase-value").textContent = phase;
        }
        if (points !== null) {
          document.getElementById("points").value = points;
          document.getElementById("points-value").textContent = points;
        }
        if (size !== null) {
          document.getElementById("size").value = size;
          document.getElementById("size-value").textContent = size;
        }
        if (opacity !== null) {
          document.getElementById("opacity").value = opacity;
          document.getElementById("opacity-value").textContent = opacity;
        }
      }

      sliders.forEach((slider) =>
        slider.addEventListener("input", updateValues)
      );

      // Toggle button for controls
      const toggleButton = document.getElementById("toggle-controls");
      toggleButton.addEventListener("click", () => {
        const controls = document.getElementById("controls");
        controls.style.display =
          controls.style.display === "none" ? "block" : "none";
        console.log(controls.style.display);
      });

      // Adjust canvas to fit window size
      function resizeCanvas() {
        const canvas = document.getElementById("waveCanvas");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        updateValues();
      }
      window.addEventListener("resize", resizeCanvas);
      // Call setSliderValues when the page loads
      window.onload = function () {
        setSliderValues();

        resizeCanvas(); // Initial resize
      };
    </script>
  </body>
</html>
